<?php

session_start();

$name = $_POST['name'];

if (isset($_SESSION['username'])) {

    //Conection to database
    $conn = pg_connect("host=localhost dbname=SSL_ANALYZER user=alumnodb password=alumnodb") or die('No pudo conectarse: ' . pg_last_error());

    //Check if the name exist
    $consulta = "SELECT * FROM exploit WHERE name = '" . $name . "';";
    $resultado = pg_query($conn, $consulta) or die('Consulta fallida: ' . pg_last_error());
    $linea = pg_fetch_row($resultado, null, PGSQL_ASSOC);

    if ($linea['name'] == '') {
        echo 'Error: Exploit doesnt exist';
        exit();
    } else {
        //Put the name of the exploit as title
        echo '<h2>' . $name . '</h2>';

        //Check if the exploit has description
        if ($linea['description'] != '') {

            echo '<br><h1>Description:</h1><br>';
            echo '<div class="description">' . $linea['description'] . '</div>';
        }

        echo '<br><h1>File:</h1><br>';
        //Get the file
        $file = file_get_contents("exploit/" . $_SESSION['username'] . "/" . $name . "/" . $name . ".py", true);
        echo '<div class="description">
<img src="fonts/download.png" width="40px" ;="" height="45px" style="
    background-color: #424BF4;
    border-radius: 50%;
    float:left;
"><div class="download"><a href="exploit/' . $_SESSION['username'] . '/' . $name . '/' . $name . '.py" target = "_blank"> ' . $name . '</a></div>
</div><br>';
    }
} else {
    echo 'Error: you must be logged';
}
?>